{"version":3,"file":"response_panel.min.js","sources":["../src/response_panel.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript controller for the \"Grading\" panel at the right of the page.\n *\n * @module     mod_questionnaire/response_panel\n * @package    mod_questionnaire\n * @class      ResponsePanel\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery','core/modal_factory','quizaccess_quizproctoring/modal_response', 'core/modal_events', 'core/notification'],\nfunction($, ModalFactory, ModalResponse, ModalEvents, Notification) {\n\n    /**\n     * ResponsePanel class.\n     *\n     * @class GradingPanel\n     * @param {String} selector The selector for the page region containing the user navigation.\n     */\n    var ResponsePanel = function(responses) {\n        this.responses = responses;\n        this.registerEventListeners();\n    };\n\n    ResponsePanel.prototype.qid = null;\n    ResponsePanel.prototype.rid = null;\n    ResponsePanel.prototype.sec = null;\n    ResponsePanel.prototype.courseid = null;\n    ResponsePanel.prototype.responses = Array();\n    ResponsePanel.prototype.index = 0;\n    ResponsePanel.prototype.quizid = 0;\n    ResponsePanel.prototype.attemptid = 0;\n    ResponsePanel.prototype.userid = 0;\n    ResponsePanel.prototype.currentpage = 1;\n    ResponsePanel.prototype.firstPage = 1;\n    ResponsePanel.prototype.lastPage = 0;\n    ResponsePanel.prototype.tempindex = 0;\n    ResponsePanel.prototype.prevpage = 0;\n    ResponsePanel.prototype.temarrayprev = Array();\n    ResponsePanel.prototype.temarraynext = Array();\n    /**\n     * Register event listeners for the grade panel.\n     *\n     * @method registerEventListeners\n     */\n    ResponsePanel.prototype.registerEventListeners = function() {\n        var docElement = $(document);\n        docElement.on('next', this._getNextUser.bind(this));\n        docElement.on('prev', this._getPreviousUser.bind(this));\n    };\n\n    /**\n     * Reset buttons method\n     */\n    ResponsePanel.prototype._reset = function() {\n        if (this.responses.length) {\n            var isFirst = this.index === 0;\n            var isLast  = this.responses.length === this.index + 1;\n            if (isFirst) {\n                if (this.firstPage == this.currentpage) {\n                    $('[data-action=\"previous\"]').prop(\"disabled\", \"disabled\");\n                } else {\n                    $('[data-action=\"previous\"]').prop(\"disabled\", false);\n                }\n                $('[data-action=\"next\"]').prop(\"disabled\", false);\n            } else if (isLast) {\n                if (this.currentpage == this.lastpage) {\n                    $('[data-action=\"next\"]').prop(\"disabled\", \"disabled\");\n                } else {\n                    $('[data-action=\"next\"]').prop(\"disabled\", false);\n                }\n                $('[data-action=\"previous\"]').prop(\"disabled\", false);\n            } else {\n                $('[data-action=\"previous\"]').prop(\"disabled\", false);\n                $('[data-action=\"next\"]').prop(\"disabled\", false);\n            }\n        }\n    };\n\n    /**\n     * First page settings\n     *\n     */\n     ResponsePanel.prototype._isFirstPage = function() {\n        var insidethid = this;\n        $.ajax({\n            url: M.cfg.wwwroot + '/mod/quiz/report/overview/ajax.php',\n            data: {\n                attemptid: this.attemptid,\n                userid: this.userid,\n                quizid: this.quizid,\n                currentpage: (this.currentpage - 2)\n            },\n            dataType: 'json',\n            success : function(response) {\n                var images = JSON.parse(JSON.stringify(response));\n                insidethid.temarrayprev = images;\n                insidethid.prevpage = 1;\n            }\n        });\n     };\n\n     /**\n      * Last page settings\n      *\n      */\n    ResponsePanel.prototype._isLastPage = function() {\n        var insidethid = this;\n        $.ajax({\n            url: M.cfg.wwwroot + '/mod/quiz/report/overview/ajax.php',\n            data: {\n                attemptid: this.attemptid,\n                userid: this.userid,\n                quizid: this.quizid,\n                currentpage: this.currentpage\n            },\n            dataType: 'json',\n            success : function(response) {\n                var images = JSON.parse(JSON.stringify(response));\n                insidethid.temarraynext = images;\n                if (images[0]) {\n                    insidethid.tempindex = 1;\n                }\n            }\n        });\n    };\n\n    /**\n     * Get next user to process\n     *\n     * @method _getNextUser\n     */\n    ResponsePanel.prototype._getNextUser = function() {\n        if (this.tempindex) {\n            this.index = -1;\n            this.responses = this.temarraynext;\n            this.currentpage += 1;\n        }\n        this.tempindex = 0;\n        this.prevpage = 0;\n        this.index += 1;\n        this._reset();\n        var res = this.responses[this.index];\n        if (res) {\n            $(\".imgheading\").html(res.title);\n            $(\".userimg\").attr(\"src\",res.img);\n        }\n        var isFirst = this.index === 0;\n        if (isFirst) {\n            this._isFirstPage();\n        }\n        var isLast  = this.responses.length === this.index + 1;\n        if (isLast) {\n            this._isLastPage();\n        }\n\n    };\n\n    /**\n     * Get previous user to process\n     *\n     * @method _getNextUser\n     */\n    ResponsePanel.prototype._getPreviousUser = function() {\n        if (this.tempindex) {\n            this.index = 18;\n        } else {\n            this.index -= 1;\n        }\n\n        if (this.prevpage) {\n            this.index = 19;\n            this.responses = this.temarrayprev;\n            this.currentpage -= 1;\n        }\n        this.prevpage = 0;\n        this.tempindex = 0;\n        this._reset();\n        var res = this.responses[this.index];\n        if (res) {\n            $(\".imgheading\").html(res.title);\n            $(\".userimg\").attr(\"src\",res.img);\n        }\n        var isFirst = this.index === 0;\n        if (isFirst) {\n            this._isFirstPage();\n        }\n\n        var isLast  = this.responses.length === this.index + 1;\n        if (isLast) {\n            this._isLastPage();\n        }\n\n    };\n\n    /**\n     * Comfirm user's response\n     *\n     * @method _rejectResponse\n     */\n    ResponsePanel.prototype._rejectResponse = function() {\n        this._rejectResponseEntry(this.qid, this.rid).then(function() {\n            window.location.reload();\n        });\n    };\n    var init = function(attemptid = null,quizid = null,userid = null) {\n        var docElement = $(document);\n        docElement.ready(function () {\n            let btn = document.createElement(\"button\");\n            btn.innerHTML = \"Proctering Images\";            \n            btn.setAttribute(\"type\", \"button\");\n            btn.setAttribute(\"value\", \"proctoringimage\");\n            btn.setAttribute(\"class\", \"proctoringimage\");\n            btn.setAttribute(\"data-attemptid\", attemptid);            \n            btn.setAttribute(\"data-quizid\", quizid);\n            btn.setAttribute(\"data-userid\", userid);\n            document.getElementById(\"page-content\").appendChild(btn);          \n        });         \n        docElement.on('click', 'button.proctoringimage', function(e){\n            e.preventDefault();\n            var quizid = $(this).data('quizid');\n            var userid = $(this).data('userid');\n            var attemptid = $(this).data('attemptid');\n            $.ajax({\n                url: M.cfg.wwwroot + '/mod/quiz/accessrule/quizproctoring/ajax_report.php',\n                data: {\n                    attemptid: $(this).data('attemptid'),\n                    userid: $(this).data('userid'),\n                    quizid: $(this).data('quizid')\n                },\n                dataType: 'json',\n                success : function(response) {\n                    var images = JSON.parse(JSON.stringify(response));\n                    var rp = new ResponsePanel(images);\n                    rp.quizid = quizid;\n                    rp.userid = userid;\n                    rp.attemptid = attemptid;\n                    rp.lastpage = rp.responses[rp.index].totalpage;\n                    ModalFactory.create({\n                        type: ModalResponse.TYPE,\n                    }).then(function(modal) {\n                        modal.getRoot().on(ModalEvents.hidden, modal.destroy.bind(modal));\n                        modal.setTitle('User Images');\n                        modal.show();\n                        $(\".imgheading\").html(rp.responses[rp.index].title);\n                        $(\".userimg\").attr(\"src\",rp.responses[rp.index].img);\n                    });\n                }\n            });\n        });\n\n       /* docElement.on('click', 'button.proctoridentity', function(e){\n            e.preventDefault();\n            $.ajax({\n                url: M.cfg.wwwroot + '/mod/quiz/accessrule/quizproctoring/proctoridentity.php',\n                data: {\n                    attemptid: $(this).data('attemptid'),\n                    userid: $(this).data('userid'),\n                    quizid: $(this).data('quizid')\n                },\n                dataType: 'json',\n                success : function(response) {\n                    var response = JSON.parse(JSON.stringify(response));\n                    if (response.success) {\n                        window.open(response.url, \"_blank\");\n                    } else {\n                        ModalFactory.create({\n                            type: ModalFactory.types.DEFAULT,\n                            body: response.message,\n                        }).then(function(modal) {\n                            modal.getRoot().on(ModalEvents.hidden, modal.destroy.bind(modal));\n                            modal.show();\n                        });\n                    }\n                }\n            });\n        });*/\n\n    };\n\n    return {\n        init: init\n    };\n});"],"names":["define","$","ModalFactory","ModalResponse","ModalEvents","Notification","ResponsePanel","responses","registerEventListeners","prototype","qid","rid","sec","courseid","Array","index","quizid","attemptid","userid","currentpage","firstPage","lastPage","tempindex","prevpage","temarrayprev","temarraynext","docElement","document","on","this","_getNextUser","bind","_getPreviousUser","_reset","length","isFirst","isLast","prop","lastpage","_isFirstPage","insidethid","ajax","url","M","cfg","wwwroot","data","dataType","success","response","images","JSON","parse","stringify","_isLastPage","res","html","title","attr","img","_rejectResponse","_rejectResponseEntry","then","window","location","reload","init","ready","btn","createElement","innerHTML","setAttribute","getElementById","appendChild","e","preventDefault","rp","totalpage","create","type","TYPE","modal","getRoot","hidden","destroy","setTitle","show"],"mappings":"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"}